var P=Object.defineProperty;var I=(e,t,o)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var s=(e,t,o)=>(I(e,typeof t!="symbol"?t+"":t,o),o);import{V as M,Q as T,S as R,C as E,P as z,W as v,O,G as W,A as H,T as k,R as $,M as N,a as _,b as F,c as Q,D as V,d as j}from"./vendor.973dd1df.js";const G=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}};G();const w="w",m="a",g="s",p="d",C="shift",q=[w,m,g,p];class K{constructor(){s(this,"map",new Map);const t=document.createElement("div"),o=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div");this.map.set(w,t),this.map.set(m,o),this.map.set(g,r),this.map.set(p,i),this.map.set(C,n),this.map.forEach((a,c)=>{a.style.color="blue",a.style.fontSize="50px",a.style.fontWeight="800",a.style.position="absolute",a.textContent=c}),this.updatePosition(),this.map.forEach((a,c)=>{document.body.append(a)})}updatePosition(){this.map.get(w).style.top=`${window.innerHeight-150}px`,this.map.get(m).style.top=`${window.innerHeight-100}px`,this.map.get(g).style.top=`${window.innerHeight-100}px`,this.map.get(p).style.top=`${window.innerHeight-100}px`,this.map.get(C).style.top=`${window.innerHeight-100}px`,this.map.get(w).style.left=`${300}px`,this.map.get(m).style.left=`${200}px`,this.map.get(g).style.left=`${300}px`,this.map.get(p).style.left=`${400}px`,this.map.get(C).style.left=`${50}px`}down(t){this.map.get(t.toLowerCase())&&(this.map.get(t.toLowerCase()).style.color="red")}up(t){this.map.get(t.toLowerCase())&&(this.map.get(t.toLowerCase()).style.color="blue")}}class U{constructor(t,o,r,i,n,a){s(this,"model");s(this,"mixer");s(this,"animationsMap",new Map);s(this,"orbitControl");s(this,"camera");s(this,"toggleRun",!0);s(this,"currentAction");s(this,"walkDirection",new M);s(this,"rotateAngle",new M(0,1,0));s(this,"rotateQuarternion",new T);s(this,"cameraTarget",new M);s(this,"fadeDuration",.2);s(this,"runVelocity",5);s(this,"walkVelocity",2);this.model=t,this.mixer=o,this.animationsMap=r,this.currentAction=a,this.animationsMap.forEach((c,l)=>{l==a&&c.play()}),this.orbitControl=i,this.camera=n,this.updateCameraTarget(0,0)}switchRunToggle(){this.toggleRun=!this.toggleRun}update(t,o){const r=q.some(c=>o[c]==!0);var i="";if(r&&this.toggleRun?i="Run":r?i="Walk":i="Idle",this.currentAction!=i){const c=this.animationsMap.get(i);this.animationsMap.get(this.currentAction).fadeOut(this.fadeDuration),c.reset().fadeIn(this.fadeDuration).play(),this.currentAction=i}if(this.mixer.update(t),this.currentAction=="Run"||this.currentAction=="Walk"){var n=Math.atan2(this.camera.position.x-this.model.position.x,this.camera.position.z-this.model.position.z),a=this.directionOffset(o);this.rotateQuarternion.setFromAxisAngle(this.rotateAngle,n+a),this.model.quaternion.rotateTowards(this.rotateQuarternion,.2),this.camera.getWorldDirection(this.walkDirection),this.walkDirection.y=0,this.walkDirection.normalize(),this.walkDirection.applyAxisAngle(this.rotateAngle,a);const c=this.currentAction=="Run"?this.runVelocity:this.walkVelocity,l=this.walkDirection.x*c*t,x=this.walkDirection.z*c*t;this.model.position.x+=l,this.model.position.z+=x,this.updateCameraTarget(l,x)}}updateCameraTarget(t,o){this.camera.position.x+=t,this.camera.position.z+=o,this.cameraTarget.x=this.model.position.x,this.cameraTarget.y=this.model.position.y+1,this.cameraTarget.z=this.model.position.z,this.orbitControl.target=this.cameraTarget}directionOffset(t){var o=0;return t[w]?t[m]?o=Math.PI/4:t[p]&&(o=-Math.PI/4):t[g]?t[m]?o=Math.PI/4+Math.PI/2:t[p]?o=-Math.PI/4-Math.PI/2:o=Math.PI:t[m]?o=Math.PI/2:t[p]&&(o=-Math.PI/2),o}}const f=new R;f.background=new E(11067120);const d=new z(45,window.innerWidth/window.innerHeight,.1,1e3);d.position.y=5;d.position.z=5;d.position.x=0;const u=new v({antialias:!0});u.setSize(window.innerWidth,window.innerHeight);u.setPixelRatio(window.devicePixelRatio);u.shadowMap.enabled=!0;const h=new O(d,u.domElement);h.enableDamping=!0;h.minDistance=5;h.maxDistance=15;h.enablePan=!1;h.maxPolarAngle=Math.PI/2-.05;h.update();J();B();var y;new W().load("models/Soldier.glb",function(e){const t=e.scene;t.traverse(function(n){n.isMesh&&(n.castShadow=!0)}),f.add(t);const o=e.animations,r=new H(t),i=new Map;o.filter(n=>n.name!="TPose").forEach(n=>{i.set(n.name,r.clipAction(n))}),y=new U(t,r,i,h,d,"Idle")});const A={},D=new K;document.addEventListener("keydown",e=>{D.down(e.key),e.shiftKey&&y?y.switchRunToggle():A[e.key.toLowerCase()]=!0},!1);document.addEventListener("keyup",e=>{D.up(e.key),A[e.key.toLowerCase()]=!1},!1);const X=new j;function b(){let e=X.getDelta();y&&y.update(e,A),h.update(),u.render(f,d),requestAnimationFrame(b)}document.body.appendChild(u.domElement);b();function Z(){d.aspect=window.innerWidth/window.innerHeight,d.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight),D.updatePosition()}window.addEventListener("resize",Z);function B(){const e=new k,t=e.load("./textures/sand/Sand 002_COLOR.jpg"),o=e.load("./textures/sand/Sand 002_NRM.jpg"),r=e.load("./textures/sand/Sand 002_DISP.jpg"),i=e.load("./textures/sand/Sand 002_OCC.jpg");t.wrapS=t.wrapT=$;const n=15,a=15,c=4,l=4;t.repeat.set(c*n/2,l*a/2);const x=new N({map:t,normalMap:o,displacementMap:r,displacementScale:.1,aoMap:i}),S=new _(c*n,l*a,512,512),L=new F(S,x);L.rotation.x=-Math.PI/2,f.add(L)}function J(){f.add(new Q(16777215,.7));const e=new V(16777215,1);e.position.set(-60,100,-10),e.castShadow=!0,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.near=.1,e.shadow.camera.far=200,e.shadow.mapSize.width=4096,e.shadow.mapSize.height=4096,f.add(e)}
